@startuml
' === CONFIGURACI√ìN DE ALTO CONTRASTE Y VERTICALIDAD ===
skinparam shadowing false
skinparam roundcorner 10
skinparam dpi 150
skinparam defaultFontName "Segoe UI", "Verdana"
skinparam TitleFontSize 22
skinparam TitleFontStyle bold

' Grosor de flechas general aumentado a 3 para m√°xima visibilidad
skinparam arrow {
    Thickness 5
    Color #444444
}

' Forzar direcci√≥n vertical estricta
top to bottom direction

' Estilos de componentes
skinparam rectangle {
    BackgroundColor<<Internet>> #FFFFFF
    BorderColor<<Internet>> #3498DB
    BackgroundColor<<Infra>> #F8F9FA
    BorderColor<<Infra>> #2C3E50
}

skinparam package {
    BackgroundColor #FFFFFF
    BorderColor #BDC3C7
    FontStyle bold
}

' Colores espec√≠ficos para componentes clave
skinparam component {
    BackgroundColor<<App>> #D6EAF8
    BackgroundColor<<DB>> #FAD7A0
    BackgroundColor<<Proxy>> #DBB6EE
    BackgroundColor<<Engine>> #2496ED
    FontColor<<Engine>> White
    BackgroundColor<<Monitor>> #D5F5E3
}

title "NEBULA: Arquitectura T√©cnica de Precisi√≥n\n"

' --- CAPA DE ACCESO ---
rectangle "üåê FLUJO DE ENTRADA" <<Internet>> {
    [<b>Usuario / Cliente</b>\n(Navegador Web)] as User
}

' --- CAPA DE SEGURIDAD OS ---
rectangle "üõ°Ô∏è HOST HARDENING (Ubuntu 24.04)" <<Infra>> {
    [<b>Firewall UFW / Fail2Ban</b>] as Security #E74C3C
}

' --- CAPA DE ORQUESTACI√ìN (DOCKER ENGINE) ---
component "üê≥ <b>DOCKER ENGINE / DAEMON</b>" <<Engine>> as DockerEngine

' --- CAPA DE SERVICIOS (CONTENEDORES) ---
rectangle "üì¶ ENTORNO DE SERVICIOS" <<Infra>> {
    
    package "Ingreso y Tr√°fico" {
        [<b>Nginx Proxy Manager</b>\n(SSL & Reverse Proxy)] as NPM <<Proxy>>
    }

    package "L√≥gica de Negocio" {
        [<b>App Web 1</b>\n(Frontend/Backend)] as App1 <<App>>
        [<b>App Web 2</b>\n(Microservicio)] as App2 <<App>>
    }

    package "Capa de Persistencia" {
        [<b>Base de Datos</b>\n(PostgreSQL / Redis)] as DB <<DB>>
    }
}

' --- CAPA DE OBSERVABILIDAD ---
package "üìä MONITORIZACI√ìN INTEGRAL" {
    [<b>Netdata Agent</b>] as Netdata <<Monitor>>
}

' === RELACIONES T√âCNICAS (CON GROSOR REFORZADO) ===

' 1. Flujo de Tr√°fico (Flechas Externas e Internas Bold)
User -[#3498DB,bold]down-> Security : "HTTPS (443)"
Security -[#3498DB,bold]down-> NPM : "Filtro Pass"
NPM -[#8E44AD,bold]down-> App1
NPM -[#8E44AD,bold]down-> App2
App1 -[#D35400,bold]down-> DB : "Persistencia"
App2 -[#D35400,bold]down-> DB

' 2. Dependencia de Orquestaci√≥n
DockerEngine -[#2496ED,dashed]up-> NPM : "<<manage>>"
DockerEngine -[#2496ED,dashed]up-> App1 : "<<manage>>"
DockerEngine -[#2496ED,dashed]up-> DB : "<<manage>>"

' 3. Monitorizaci√≥n 360¬∞
Netdata -[#27AE60,dotted]up-> Security : "Logs de Red"
Netdata -[#27AE60,dotted]up-> DockerEngine : "Estado Daemon"
Netdata -[#27AE60,dotted]up-> DB : "M√©tricas DB"
Netdata -[#27AE60,dotted]up-> App1 : "Stats Contenedor"

' Notas de Arquitectura
note left of DockerEngine
  <b>Docker Engine:</b>
  A√≠sla recursos y gestiona el
  ciclo de vida de cada servicio.
end note

note right of DB
  <b>Persistencia:</b>
  Separada de la l√≥gica de
  apps para escalabilidad.
end note

@enduml
